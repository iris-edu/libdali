<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libdali: Connection network functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libdali
   &#160;<span id="projectnumber">1.8.0</span>
   </div>
   <div id="projectbrief">The DataLink client library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Connection network functions</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions for network DataLink connections.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac26d1376529c62dc85ae3ae90f2d0279"><td class="memItemLeft" align="right" valign="top"><a class="el" href="libdali_8h.html#aff55fe551a9992a54ec54621c524d0a4">SOCKET</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__network.html#gac26d1376529c62dc85ae3ae90f2d0279">dl_connect</a> (DLCP *dlconn)</td></tr>
<tr class="memdesc:gac26d1376529c62dc85ae3ae90f2d0279"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connect to a DataLink server.  <a href="group__network.html#gac26d1376529c62dc85ae3ae90f2d0279">More...</a><br /></td></tr>
<tr class="separator:gac26d1376529c62dc85ae3ae90f2d0279"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5b31313fabb3c66918276e87695dec16"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__network.html#ga5b31313fabb3c66918276e87695dec16">dl_disconnect</a> (DLCP *dlconn)</td></tr>
<tr class="memdesc:ga5b31313fabb3c66918276e87695dec16"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disconnect a DataLink connection.  <a href="group__network.html#ga5b31313fabb3c66918276e87695dec16">More...</a><br /></td></tr>
<tr class="separator:ga5b31313fabb3c66918276e87695dec16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3bdb00c1cd5ecdbd464ee9012fa80f6d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__network.html#ga3bdb00c1cd5ecdbd464ee9012fa80f6d">dl_senddata</a> (DLCP *dlconn, void *buffer, size_t sendlen)</td></tr>
<tr class="memdesc:ga3bdb00c1cd5ecdbd464ee9012fa80f6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send arbitrary data to a DataLink server.  <a href="group__network.html#ga3bdb00c1cd5ecdbd464ee9012fa80f6d">More...</a><br /></td></tr>
<tr class="separator:ga3bdb00c1cd5ecdbd464ee9012fa80f6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga15eee68e254a3fc494acfd51ae623c70"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__network.html#ga15eee68e254a3fc494acfd51ae623c70">dl_sendpacket</a> (DLCP *dlconn, void *headerbuf, size_t headerlen, void *databuf, size_t datalen, void *respbuf, int resplen)</td></tr>
<tr class="memdesc:ga15eee68e254a3fc494acfd51ae623c70"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create and send a DataLink packet.  <a href="group__network.html#ga15eee68e254a3fc494acfd51ae623c70">More...</a><br /></td></tr>
<tr class="separator:ga15eee68e254a3fc494acfd51ae623c70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa38aa90808beee57585044aab4c8e817"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__network.html#gaa38aa90808beee57585044aab4c8e817">dl_recvdata</a> (DLCP *dlconn, void *buffer, size_t readlen, uint8_t blockflag)</td></tr>
<tr class="memdesc:gaa38aa90808beee57585044aab4c8e817"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive arbitrary data from a DataLink server.  <a href="group__network.html#gaa38aa90808beee57585044aab4c8e817">More...</a><br /></td></tr>
<tr class="separator:gaa38aa90808beee57585044aab4c8e817"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9965316177619f3588cdd22b78899bd1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__network.html#ga9965316177619f3588cdd22b78899bd1">dl_recvheader</a> (DLCP *dlconn, void *buffer, size_t buflen, uint8_t blockflag)</td></tr>
<tr class="memdesc:ga9965316177619f3588cdd22b78899bd1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive DataLink packet header.  <a href="group__network.html#ga9965316177619f3588cdd22b78899bd1">More...</a><br /></td></tr>
<tr class="separator:ga9965316177619f3588cdd22b78899bd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Functions for network DataLink connections. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gac26d1376529c62dc85ae3ae90f2d0279"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac26d1376529c62dc85ae3ae90f2d0279">&#9670;&nbsp;</a></span>dl_connect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="libdali_8h.html#aff55fe551a9992a54ec54621c524d0a4">SOCKET</a> dl_connect </td>
          <td>(</td>
          <td class="paramtype">DLCP *&#160;</td>
          <td class="paramname"><em>dlconn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Connect to a DataLink server. </p>
<p>Open a network socket connection to a Datalink server and set 'dlconn-&gt;link' to the new descriptor. Expects 'dlconn-&gt;addr' to be in 'host:port' or 'host@port' format. Either the host, port or both are optional, if the host is not specified 'localhost' is assumed, if the port is not specified '16000' is assumed, if neither is specified (only a separator) then 'localhost' and port '16000' are assumed.</p>
<p>If a permanent error is detected (invalid port specified) the dlconn-&gt;terminate flag will be set so the <a class="el" href="group__connection.html#gaccca46f231c23fd495bb6d5725e97957" title="Collect packets streaming from the DataLink server.">dl_collect()</a> family of routines will not continue trying to connect.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the socket descriptor created. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>on errors </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga5b31313fabb3c66918276e87695dec16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5b31313fabb3c66918276e87695dec16">&#9670;&nbsp;</a></span>dl_disconnect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dl_disconnect </td>
          <td>(</td>
          <td class="paramtype">DLCP *&#160;</td>
          <td class="paramname"><em>dlconn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disconnect a DataLink connection. </p>
<p>Close the network socket associated with connection and set 'dlconn-&gt;link' to -1.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga3bdb00c1cd5ecdbd464ee9012fa80f6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3bdb00c1cd5ecdbd464ee9012fa80f6d">&#9670;&nbsp;</a></span>dl_senddata()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_senddata </td>
          <td>(</td>
          <td class="paramtype">DLCP *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>sendlen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send arbitrary data to a DataLink server. </p>
<p>This fundamental routine is used by other library routines to send data via a DataLink connection. Before data is sent the socket to set to blocking mode and back to non-blocking before returning unless there was an error in which case the socket should be disconnected.</p>
<p>If a user specified network I/O timeout was not applied at the system socket level this routine will implement the timeout using an alarm timer to interrupt the blocked send.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">buffer</td><td>Buffer containing data to send </td></tr>
    <tr><td class="paramname">sendlen</td><td>Number of bytes to send from buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">-1</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga15eee68e254a3fc494acfd51ae623c70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga15eee68e254a3fc494acfd51ae623c70">&#9670;&nbsp;</a></span>dl_sendpacket()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_sendpacket </td>
          <td>(</td>
          <td class="paramtype">DLCP *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>headerbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>headerlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>databuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>datalen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>respbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>resplen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create and send a DataLink packet. </p>
<p>Send a DataLink packet created by combining an appropriate preheader with <em>headerbuf</em> and, optionally, <em>databuf</em>.</p>
<p>The header length must be larger than 0 but the packet length can be 0 resulting in a header-only packet, commonly used for sending commands.</p>
<p>If the response buffer <em>respbuf</em> is not NULL then read up to <em>resplen</em> bytes into <em>respbuf</em> using <a class="el" href="group__network.html#ga9965316177619f3588cdd22b78899bd1" title="Receive DataLink packet header.">dl_recvheader()</a> after sending the packet. This is only designed for small pieces of data, specifically the server acknowledgement to a command, which are a header-only packets.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">headerbuf</td><td>Buffer containing DataLink packet header </td></tr>
    <tr><td class="paramname">headerlen</td><td>Length of header buffer to send </td></tr>
    <tr><td class="paramname">databuf</td><td>Buffer containing DataLink packet data </td></tr>
    <tr><td class="paramname">datalen</td><td>Length of data buffer to send </td></tr>
    <tr><td class="paramname">respbuf</td><td>Buffer to place response from server </td></tr>
    <tr><td class="paramname">resplen</td><td>Length of response buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes of response received </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success and <em>respbuf</em> is NULL </td></tr>
    <tr><td class="paramname">-1</td><td>on error </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gaa38aa90808beee57585044aab4c8e817"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa38aa90808beee57585044aab4c8e817">&#9670;&nbsp;</a></span>dl_recvdata()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_recvdata </td>
          <td>(</td>
          <td class="paramtype">DLCP *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>readlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>blockflag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive arbitrary data from a DataLink server. </p>
<p>This fundamental routine is used by other library routines to receive data from a DataLink server. Up to <em>readlen</em> bytes of received data is placed into <em>buffer</em>.</p>
<p>If <em>blockflag</em> is true (1) this function will block until <em>readlen</em> bytes have been read. If <em>blockflag</em> is false (0) and no data is available for reading this function will immediately return. If <em>blockflag</em> is false and some initial data is received the function will block until <em>readlen</em> bytes have been read.</p>
<p>If a user specified network I/O timeout was not applied at the system socket level this routine will implement the timeout using an alarm timer to interrupt the blocked send.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">buffer</td><td>Buffer for received data </td></tr>
    <tr><td class="paramname">readlen</td><td>Number of bytes to read and place into <em>buffer</em> </td></tr>
    <tr><td class="paramname">blockflag</td><td>Flag to control use of blocking versus non-blocking mode</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes read on success </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>when no data available on non-blocking socket </td></tr>
    <tr><td class="paramname">-1</td><td>on connection shutdown </td></tr>
    <tr><td class="paramname">-2</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga9965316177619f3588cdd22b78899bd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9965316177619f3588cdd22b78899bd1">&#9670;&nbsp;</a></span>dl_recvheader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_recvheader </td>
          <td>(</td>
          <td class="paramtype">DLCP *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>buflen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>blockflag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive DataLink packet header. </p>
<p>Receive a DataLink packet header and place it into <em>buffer</em> up to <em>buflen</em> bytes in length.</p>
<p>The header body returned in <em>buffer</em> will always be NULL terminated. The buffer must be at least 255 bytes in size. The maximum header length is effectively 254 bytes.</p>
<dl class="section return"><dt>Returns</dt><dd>number of bytes read on success </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>when no data available on non-blocking socket </td></tr>
    <tr><td class="paramname">-1</td><td>on connection shutdown </td></tr>
    <tr><td class="paramname">-2</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- GitHub corner from https://github.com/tholman/github-corners -->
<a href="https://github.com/iris-edu/libdali" class="github-corner" aria-label="View source on GitHub"><svg width="75" height="75" viewBox="0 0 250 250" style="fill:#442487; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<a href="https://ds.iris.edu"><img style="position: absolute; top: 0; border: 0; right: 75px; height:75px;" src="https://www.iris.edu/hq/files/publications/logos/iris_color_screen.png"></a>
